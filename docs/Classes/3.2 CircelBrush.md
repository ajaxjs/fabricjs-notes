# CircleBrush 类总结（Fabric.js）
CircleBrush 是 Fabric.js 中继承自 `BaseBrush` 的具体画笔类，定义于 `src/brushes/CircleBrush.ts:12`，核心功能是在画布上绘制圆形或类圆形笔触（如圆点、连续圆形图案），适用于创建装饰性图形、点云效果等场景，可通过调整属性自定义笔触样式。以下从 **类基础信息**、**构造函数**、**属性（含继承与重写）**、**核心方法** 四部分总结核心内容。


## 一、类基础信息
| 项目 | 详情 |
|------|------|
| 类名 | `CircleBrush` |
| 定义路径 | src/brushes/CircleBrush.ts:12 |
| 继承关系 | 继承自 `BaseBrush`（所有画笔的抽象基类） |
| 核心作用 | 绘制圆形/类圆形笔触，支持鼠标按下/移动/松开时的连续或单点圆形绘制 |
| 参考资源 | [Fabric.js CircleBrush 演示（demo）](https://fabricjs.com/demos) |


## 二、构造函数
| 构造函数 | 参数 | 返回值 | 说明 |
|----------|------|--------|------|
| `new CircleBrush(canvas)` | `canvas`: `Canvas`（必填，画笔绑定的画布实例，用于获取绘制上下文） | `CircleBrush`（新创建的 CircleBrush 实例） | 重写 `BaseBrush` 的构造函数，初始化圆形画笔并关联到指定画布，是实例化 CircleBrush 的唯一入口 |


## 三、属性（继承+自有+重写）
CircleBrush 的属性分为 **继承自 BaseBrush 的通用属性**、**自有属性** 和 **重写属性**，其中自有属性为圆形画笔特有，重写属性修改了基类的默认值。

| 属性名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `canvas` | `Canvas` | - | 画笔绑定的画布实例（待补充更具体类型注解） |
| `color` | `string` | `'rgb(0, 0, 0)'`（黑色） | 圆形笔触的颜色，支持 CSS 颜色格式（Hex、RGB 等） |
| `limitedToCanvasSize` | `boolean` | `false` | 控制绘制范围是否限制在画布内：`true` 限制，`false` 允许画布外绘制（默认） |
| `shadow` | `null` \| `Shadow` | `null` | 圆形笔触的阴影效果（需传 `Shadow` 实例），自 v1.2.12 起替代旧版 `shadowColor` 等单个属性 |
| `strokeDashArray` | `null` \| `number`[] | `null` | 笔触的虚线模式（如 `[5,3]` 表示“5像素实线+3像素空白”），`null` 为实线（默认） |
| `strokeLineCap` | `CanvasLineCap` | `'round'` | 笔触线端样式（仅影响多段线连接，圆形笔触中作用较小），可选 `butt`/`round`/`square` |
| `strokeLineJoin` | `CanvasLineJoin` | `'round'` | 笔触拐角样式（圆形笔触中作用较小），可选 `bevel`/`round`/`miter` |
| `strokeMiterLimit` | `number` | `10` | 最大斜接长度（仅 `strokeLineJoin='miter'` 时生效） |
| `points` | `CircleBrushPoint`[] | - | 存储圆形笔触的坐标点集合，记录绘制过程中所有圆形的位置、尺寸等信息 |
| `width` | `number` | `10`（像素） | 圆形笔触的直径（重写 `BaseBrush` 的默认值 `1`），决定圆形的大小，必须为数字 |


## 四、核心方法（重写+自有）
CircleBrush 重写了 `BaseBrush` 的抽象交互方法（实现鼠标按下/移动/松开逻辑），并新增自有方法处理圆形绘制，所有方法围绕“创建圆形笔触”展开。

| 方法名 | 参数 | 核心功能 |
|--------|------|----------|
| `onMouseDown` | `pointer`: `Point`（鼠标按下时的画布坐标） | 鼠标按下时触发：初始化绘制，调用 `drawDot` 方法在当前坐标绘制第一个圆形 |
| `onMouseMove` | `pointer`: `Point`（鼠标移动时的画布坐标） | 鼠标移动时触发：持续调用 `drawDot` 方法，在移动路径上绘制连续圆形，形成“拖动画圆”效果 |
| `onMouseUp` | - | 鼠标松开时触发：结束绘制，无额外逻辑（如需保存绘制结果可在此扩展） |
| `drawDot` | `pointer`: `Point`（目标坐标点） | 核心绘制方法：在指定坐标 `pointer` 处创建圆形，内部调用 `addPoint` 记录点信息，再调用 `dot` 渲染圆形 |
| `dot` | - `ctx`: `CanvasRenderingContext2D`（画布上下文）<br>- `point`: `CircleBrushPoint`（圆形点数据） | 底层渲染方法：通过 Canvas 2D 上下文绘制圆形，使用 `arc` 方法绘制圆弧，应用 `color`、`width` 等属性 |
| `addPoint` | `pointer`: `Point`（坐标点） | 数据记录方法：将当前坐标点转换为 `CircleBrushPoint` 格式（含位置、尺寸等），添加到 `points` 数组并返回该点 |


## 关键特点总结
1. **专注圆形笔触**：区别于 `PencilBrush` 的自由线条，CircleBrush 仅生成圆形，适合绘制点、圆形图案等；
2. **参数可定制**：通过 `width`（圆形大小）、`color`（颜色）、`shadow`（阴影）等属性，可快速调整笔触风格；
3. **交互逻辑清晰**：鼠标按下画起点圆、移动画连续圆、松开结束，符合直觉式操作；
4. **继承扩展性**：基于 `BaseBrush` 抽象类，可通过重写 `dot` 或 `addPoint` 方法实现自定义圆形效果（如椭圆、环形）。